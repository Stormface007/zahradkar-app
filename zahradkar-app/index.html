<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zahr√°dk√°≈ôsk√Ω syst√©m</title>
  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
</head>

<body>
  <!-- AI avatar chat widget -->
  <div id="aiAvatarWidget">
    <div id="aiAvatarBubble" onclick="toggleAiChat()">
      <img src="img/HUGO2.png" alt="Zahradn√≠k" />
    </div>

    <div id="aiAvatarChat" class="hidden">
      <div class="ai-chat-header">
        <span>Garden helper</span>
        <button type="button" onclick="toggleAiChat()">‚úï</button>
      </div>
      <div class="ai-chat-messages" id="aiChatMessages"></div>
      <div class="ai-chat-input-row">
        <input
          type="text"
          id="aiChatInput"
          placeholder="Zeptej se na set√≠, hnojen√≠..."
        />
        <button type="button" onclick="sendAiMessage()">‚ñ∂</button>
      </div>
    </div>
  </div>

  <!-- Indik√°tor akce -->
  <div id="actionIndicator" class="action-indicator">
    <img src="img/Plodina_mrkev .png" alt="Vizualizace akce" />
  </div>

  <!-- P≈ôihla≈°ovac√≠ formul√°≈ô -->
  <div id="loginDiv">
    <img
      src="img/icon_trimmed_transparent_customcolor.png"
      alt="Logo"
      class="logo-small"
    />
    <input type="text" id="username" placeholder="U≈æivatelsk√© jm√©no" />
    <input type="password" id="password" placeholder="Heslo" />
    <button type="button" onclick="login()">P≈ôihl√°sit</button>
    <div id="loginMsg"></div>
  </div>

  <!-- Hlavn√≠ aplikace -->
  <div id="appDiv" style="display:none;">

    <div class="top-panel">
      <div id="weatherContainer" class="toolbar-weather">
        <img id="weatherIcon" alt="Poƒças√≠" />
        <div id="weatherTemp">‚Äì</div>
      </div>
      <img
        id="exitIcon"
        class="icon-button"
        src="img/Exit.png"
        alt="Odhl√°sit se"
        onclick="logout()"
      />
      <img
        id="userIcon"
        class="icon-button"
        src="img/User.png"
        alt="U≈æivatel"
      />
    </div>

    <div class="table-actions">
      <button type="button" onclick="deleteSelected()">üóëÔ∏è Smazat oznaƒçen√©</button>
    </div>

    <div class="table-container">
      <table id="zahonyTable">
        <thead>
          <tr>
            <th></th>
            <th>N√°zev z√°honu</th>
            <th>Velikost</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- P≈ôidat nov√Ω z√°hon -->
    <div id="addZahonPanel">
      <h2>P≈ôidat nov√Ω z√°hon</h2>

      <label for="newNazev">N√°zev</label>
      <input type="text" id="newNazev" placeholder="Nap≈ô. U vany" />

      <label for="newDelka">D√©lka (m)</label>
      <input
        type="number"
        id="newDelka"
        min="0"
        step="0.1"
        placeholder="Nap≈ô. 3,7"
      />

      <label for="newSirka">≈†√≠≈ôka (m)</label>
      <input
        type="number"
        id="newSirka"
        min="0"
        step="0.1"
        placeholder="Nap≈ô. 1,2"
      />

      <label>Typ plochy</label>
      <div class="typ-plochy-row">
        <input
          type="radio"
          name="typPlochy"
          value="zahon"
          id="typ-zahon"
          checked
        />
        <label for="typ-zahon">üåæ Z√°hon</label>
      </div>
      <div class="typ-plochy-row">
        <input
          type="radio"
          name="typPlochy"
          value="sklenik"
          id="typ-sklenik"
        />
        <label for="typ-sklenik">üè† Sklen√≠k</label>
      </div>
      <div class="typ-plochy-row">
        <input
          type="radio"
          name="typPlochy"
          value="nadoba"
          id="typ-nadoba"
        />
        <label for="typ-nadoba">ü™¥ N√°doba (truhl√≠k/pytel)</label>
      </div>

      <!-- Lokace z√°honu -->
      <h3>Lokace z√°honu</h3>

      <!-- voliteln√Ω v√Ωbƒõr ulo≈æen√© lokace -->
      <label for="newLokace">Ulo≈æen√° lokace</label>
      <select id="newLokace">
        <option value="">‚Äì vyber lokaci ‚Äì</option>
        <!-- dopln√≠≈° dynamicky ze sheetu Lokace -->
      </select>

      <label for="newLokaceText">Popis lokace</label>
      <input
        type="text"
        id="newLokaceText"
        placeholder="Nap≈ô. Domov ‚Äì zahrada za domem"
      />

      <div class="dimensions">
        <div>
          <label for="newLat">Lat (¬∞)</label>
          <input
            type="number"
            id="newLat"
            step="0.000001"
            placeholder="49.400000"
          />
        </div>
        <div>
          <label for="newLon">Lon (¬∞)</label>
          <input
            type="number"
            id="newLon"
            step="0.000001"
            placeholder="15.600000"
          />
        </div>
      </div>

      <button type="button" onclick="fillNewBedLocationFromHere()">
        Pou≈æ√≠t moji aktu√°ln√≠ polohu
      </button>

      <div class="actions">
        <button type="button" onclick="addZahon()">P≈ôidat</button>
      </div>
    </div>

  </div><!-- /appDiv -->

  <!-- MOD√ÅLN√ç OKNO pro editaci z√°honu a akce -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <!-- Boƒçn√≠ panel ikon -->
      <div class="side-icons">
        <img
          id="icon-mereni"
          class="side-icon"
          src="img/mereni.png"
          alt="Mƒõ≈ôen√≠"
          onclick="onIconClick('mereni')"
        />
        <img
          id="icon-seti"
          class="side-icon"
          src="img/sklizen.png"
          alt="Set√≠ / Sklize≈à"
          onclick="onIconClick('seti')"
        />
        <img
          id="icon-hnojeni"
          class="side-icon"
          src="img/hnojeni.png"
          alt="Hnojen√≠"
          onclick="onIconClick('hnojeni')"
        />
        <img
          id="icon-analyza"
          class="side-icon"
          src="img/analyza.png"
          alt="Anal√Ωza"
          onclick="onIconClick('analyza')"
        />
        <img
          id="icon-nastaveni"
          class="side-icon"
          src="img/nastaveni.png"
          alt="Nastaven√≠"
          onclick="onIconClick('nastaveni')"
        />
      </div>

      <div class="modal-body">
        <div id="nazevZahonu" class="modal-zahon-name"></div>

        <!-- Z√°kladn√≠ editace z√°honu -->
        <div id="modalViewDefault">
          <h3>√öprava z√°honu</h3>
          <input type="text" id="editNazev" placeholder="N√°zev z√°honu" />

          <div class="dimensions">
            <input
              type="number"
              id="editDelka"
              placeholder="D√©lka (m)"
              min="0"
              oninput="updatePlocha()"
            />
            <input
              type="number"
              id="editSirka"
              placeholder="≈†√≠≈ôka (m)"
              min="0"
              oninput="updatePlocha()"
            />
          </div>

          <div class="plocha">
            Plocha: <span id="vypocetPlochy">0</span>
          </div>

          <div id="zahonVizualizace">
            <div id="canvasContainer">
              <canvas id="zahonCanvas" onclick="openZoom()"></canvas>
            </div>
          </div>

          <div class="udalost-actions">
            <img
              src="img/Safe.png"
              alt="Ulo≈æit"
              class="modal-btn"
              onclick="saveZahon()"
            />
            <img
              src="img/Goback .png"
              alt="Zav≈ô√≠t"
              class="modal-btn"
              onclick="closeModal()"
            />
          </div>
        </div>

        <!-- Formul√°≈ô ud√°lost√≠ / anal√Ωzy -->
        <div id="modalViewUdalost" style="display:none;">
          <div id="udalostFormContainer"></div>
        </div>

      </div><!-- /modal-body -->
    </div><!-- /modal-content -->
  </div><!-- /modal -->

  <!-- MOD√ÅLN√ç OKNO PRO ZVƒöT≈†EN√ù N√ÅHLED -->
  <div id="zoomModal" class="modal">
    <div class="modal-content" style="padding: 20px; max-width: 800px;">
      <h3>Zvƒõt≈°en√Ω n√°hled z√°honu</h3>
      <canvas id="zoomCanvas" width="600" height="400"></canvas>
      <br />
      <button type="button" onclick="closeZoomModal()">Zav≈ô√≠t</button>
    </div>
  </div>

</body>
</html>
