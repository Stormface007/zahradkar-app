<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zahr√°dk√°≈ôsk√Ω syst√©m</title>
  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
</head>

<body>
  <div id="root">
    <!-- AI avatar chat widget -->
    <div id="aiAvatarWidget">
      <div id="aiAvatarBubble" onclick="toggleAiChat()">
        <img src="img/HUGO2.png" alt="Zahradn√≠k" />
      </div>

      <div id="aiAvatarChat" class="hidden">
        <div class="ai-chat-header">
          <span>Garden helper</span>
          <button type="button" onclick="toggleAiChat()">‚úï</button>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages"></div>
        <div class="ai-chat-input-row">
          <input
            type="text"
            id="aiChatInput"
            placeholder="Zeptej se na set√≠, hnojen√≠..."
          />
          <button type="button" onclick="sendAiMessage()">‚ñ∂</button>
        </div>
      </div>
    </div>

    <!-- Indik√°tor akce -->
    <div id="actionIndicator" class="action-indicator">
      <img src="img/Plodina_mrkev .png" alt="Vizualizace akce" />
    </div>

    <!-- P≈ôihla≈°ovac√≠ formul√°≈ô -->
    <div id="loginDiv">
      <img
        src="img/icon_trimmed_transparent_customcolor.png"
        alt="Logo"
        class="logo-small"
      />
      <input type="text" id="username" placeholder="U≈æivatelsk√© jm√©no" />
      <input type="password" id="password" placeholder="Heslo" />
      <button type="button" onclick="login()">P≈ôihl√°sit</button>
      <div id="loginMsg"></div>
    </div>

    <!-- Hlavn√≠ aplikace -->
    <div id="appDiv" style="display:none;">

      <div class="top-panel">
        <div id="weatherContainer" class="toolbar-weather">
          <img id="weatherIcon" alt="Poƒças√≠" />
          <div id="weatherTemp">‚Äì</div>
        </div>
        <img
          id="exitIcon"
          class="icon-button"
          src="img/Exit.png"
          alt="Odhl√°sit se"
          onclick="logout()"
        />
        <img
          id="userIcon"
          class="icon-button"
          src="img/User.png"
          alt="U≈æivatel"
        />
      </div>

      <div class="table-actions">
        <button type="button" onclick="deleteSelected()">üóëÔ∏è Smazat oznaƒçen√©</button>
        <button type="button" onclick="openAddZahonModal()">‚ûï P≈ôidat z√°hon</button>
      </div>

      <div class="table-container">
        <table id="zahonyTable">
          <thead>
            <tr>
              <th></th>
              <th>N√°zev z√°honu</th>
              <th>Velikost</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div><!-- /appDiv -->

    <!-- MOD√ÅL: P≈ôidat nov√Ω z√°hon -->
    <div id="addZahonModal" class="modal">
      <div class="modal-content add-zahon-modal">
        <div class="modal-header">
          <h3>P≈ôidat nov√Ω z√°hon</h3>
          <button type="button" onclick="closeAddZahonModal()">‚úï</button>
        </div>

        <div class="modal-body-scroll">
          <!-- Taby -->
          <div class="tabs">
            <button type="button" class="tab-btn active" data-tab="tab-bed">
              Z√°hon
            </button>
            <button type="button" class="tab-btn" data-tab="tab-location">
              Lokace
            </button>
          </div>

          <!-- TAB: Z√°hon -->
          <div class="tab-content" id="tab-bed">
            <div class="form-grid form-grid--two-cols">
              <div class="form-field" style="grid-column: 1 / -1;">
                <label for="newNazev">N√°zev</label>
                <input type="text" id="newNazev" placeholder="Nap≈ô. U vany" />
              </div>

              <div class="form-field">
                <label for="newDelka">D√©lka (m)</label>
                <input
                  type="number"
                  id="newDelka"
                  min="0"
                  step="0.1"
                  placeholder="Nap≈ô. 3,7"
                />
              </div>

              <div class="form-field">
                <label for="newSirka">≈†√≠≈ôka (m)</label>
                <input
                  type="number"
                  id="newSirka"
                  min="0"
                  step="0.1"
                  placeholder="Nap≈ô. 1,2"
                />
              </div>
            </div>

            <div class="section">
              <h4>Typ plochy</h4>
              <div class="typ-plochy-row">
                <input
                  type="radio"
                  name="typPlochy"
                  value="zahon"
                  id="typ-zahon"
                  checked
                />
                <label for="typ-zahon">üåæ Z√°hon</label>
              </div>
              <div class="typ-plochy-row">
                <input
                  type="radio"
                  name="typPlochy"
                  value="sklenik"
                  id="typ-sklenik"
                />
                <label for="typ-sklenik">üè† Sklen√≠k</label>
              </div>
              <div class="typ-plochy-row">
                <input
                  type="radio"
                  name="typPlochy"
                  value="nadoba"
                  id="typ-nadoba"
                />
                <label for="typ-nadoba">ü™¥ N√°doba (truhl√≠k/pytel)</label>
              </div>
            </div>
          </div>

          <!-- TAB: Lokace -->
          <div class="tab-content hidden" id="tab-location">
            <div class="section">
              <h4>Lokace z√°honu</h4>

              <div class="form-grid">
                <div class="form-field">
                  <label for="newLokace">Ulo≈æen√° lokace</label>
                  <select id="newLokace">
                    <option value="">‚Äì vyber lokaci ‚Äì</option>
                  </select>
                </div>

                <div class="form-field">
                  <label for="newLokaceText">Popis lokace</label>
                  <input
                    type="text"
                    id="newLokaceText"
                    placeholder="Nap≈ô. Domov ‚Äì zahrada za domem"
                  />
                </div>
              </div>

              <div class="form-grid form-grid--two-cols">
                <div class="form-field">
                  <label for="newLat">Lat (¬∞)</label>
                  <input
                    type="number"
                    id="newLat"
                    step="0.000001"
                    placeholder="49.400000"
                  />
                </div>
                <div class="form-field">
                  <label for="newLon">Lon (¬∞)</label>
                  <input
                    type="number"
                    id="newLon"
                    step="0.000001"
                    placeholder="15.600000"
                  />
                </div>
              </div>

              <button type="button" onclick="fillNewBedLocationFromHere()">
                Pou≈æ√≠t moji aktu√°ln√≠ polohu
              </button>
            </div>
          </div>
        </div><!-- /modal-body-scroll -->

        <div class="modal-footer">
          <button type="button" onclick="addZahon()">P≈ôidat</button>
        </div>
      </div>
    </div>

    <!-- MOD√ÅLN√ç OKNO pro editaci z√°honu a akce -->
    <div id="modal" class="modal">
      <div class="modal-content modal-content--wide">
        <div class="modal-header">
          <div id="nazevZahonu" class="modal-zahon-name"></div>
          <button type="button" onclick="closeModal()">‚úï</button>
        </div>

        <!-- nov√Ω layout: sidebar + obsah -->
        <div class="modal-layout">
          <div class="modal-sidebar">
            <img
              id="icon-mereni"
              class="side-icon"
              src="img/mereni.png"
              alt="Mƒõ≈ôen√≠"
              onclick="onIconClick('mereni')"
            />
            <img
              id="icon-seti"
              class="side-icon"
              src="img/sklizen.png"
              alt="Set√≠ / Sklize≈à"
              onclick="onIconClick('seti')"
            />
            <img
              id="icon-hnojeni"
              class="side-icon"
              src="img/hnojeni.png"
              alt="Hnojen√≠"
              onclick="onIconClick('hnojeni')"
            />
            <img
              id="icon-analyza"
              class="side-icon"
              src="img/analyza.png"
              alt="Anal√Ωza"
              onclick="onIconClick('analyza')"
            />
            <img
              id="icon-nastaveni"
              class="side-icon"
              src="img/nastaveni.png"
              alt="Nastaven√≠"
              onclick="onIconClick('nastaveni')"
            />
          </div>

          <div class="modal-body">
            <div id="nazevZahonu" class="modal-zahon-name"></div>

            <div id="modalViewDefault">
              <h3>√öprava z√°honu</h3>
              <input type="text" id="editNazev" placeholder="N√°zev z√°honu" />

              <div class="dimensions">
                <input
                  type="number"
                  id="editDelka"
                  placeholder="D√©lka (m)"
                  min="0"
                  oninput="updatePlocha()"
                />
                <input
                  type="number"
                  id="editSirka"
                  placeholder="≈†√≠≈ôka (m)"
                  min="0"
                  oninput="updatePlocha()"
                />
              </div>

              <div class="plocha">
                Plocha: <span id="vypocetPlochy">0</span>
              </div>

              <!-- SVG vizualizace z√°honu + detail bodu -->
              <div id="zahonVizualizace">
                <div id="svgContainer">
                  <svg id="zahonSvg"
                       viewBox="0 0 100 100"
                       preserveAspectRatio="xMidYMid meet"></svg>
                </div>
                <div id="bodDetail" class="bod-detail"></div>
              </div>

              <div class="udalost-actions">
                <img
                  src="img/Safe.png"
                  alt="Ulo≈æit"
                  class="modal-btn"
                  onclick="saveZahon()"
                />
              </div>
            </div>

            <div id="modalViewUdalost" style="display:none;">
              <div id="udalostFormContainer"></div>
            </div>
          </div><!-- /modal-body -->
        </div><!-- /modal-layout -->
      </div>
    </div>

    <!-- MOD√ÅLN√ç OKNO PRO ZVƒöT≈†EN√ù N√ÅHLED (zat√≠m m≈Ø≈æe z≈Østat, nebo ho pozdƒõji zahod√≠me) -->
    <div id="zoomModal" class="modal">
      <div class="modal-content" style="padding: 20px; max-width: 800px;">
        <h3>Zvƒõt≈°en√Ω n√°hled z√°honu</h3>
        <canvas id="zoomCanvas" width="600" height="400"></canvas>
        <br />
        <button type="button" onclick="closeZoomModal()">Zav≈ô√≠t</button>
      </div>
    </div>
  </div><!-- /root -->

  <script>
    // p≈ôep√≠n√°n√≠ tab≈Ø v modalu P≈ôidat z√°hon
    document.addEventListener("click", function (e) {
      if (!e.target.classList.contains("tab-btn")) return;
      const targetTab = e.target.getAttribute("data-tab");

      document
        .querySelectorAll("#addZahonModal .tab-btn")
        .forEach((btn) => {
          btn.classList.toggle("active", btn === e.target);
        });

      document
        .querySelectorAll("#addZahonModal .tab-content")
        .forEach((div) => {
          div.classList.toggle("hidden", div.id !== targetTab);
        });
    });

    function openAddZahonModal() {
      document.getElementById("addZahonModal").style.display = "flex";
    }

    function closeAddZahonModal() {
      document.getElementById("addZahonModal").style.display = "none";
    }
  </script>
</body>
</html>
